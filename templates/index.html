<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>VMware Baseline Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f0f0f0; }
        h2 { margin-top: 40px; }
    </style>
</head>
<body>
    <h1>VMware Baseline Report</h1>
    <div id="tables"></div>

    <script>
        // JSON 文件列表
        const jsonFiles = [
            "/log/no_1.1_software_general_manual.json",
            "/log/no_1.2_ntp_info.json",
            "/log/no_1.3_time_sync_manual.json",
            "/log/no_1.4_mem_share_salt.json",
            "/log/no_2.1_tsm_ssh.json",
            "/log/no_2.2_tsm.json",
            "/log/no_2.3_solo_enable_moob.json",
            "/log/no_2.4_snmp_status.json",
            "/log/no_2.5_dcui_timeout.json",
            "/log/no_2.6_shell_warning_status.json",
            "/log/no_2.7_password_quality_control.json",
            "/log/no_2.8_account_lock_failure.json",
            "/log/no_2.9_account_unlock_time.json",
            "/log/no_2.10_password_history_manual.json",
            "/log/no_2.11_password_max_days_manual.json",
            "/log/no_2.12_session_timeout_api.json",
            "/log/no_2.13_idle_host_client_manual.json",
            "/log/no_2.14_dcui_access.json",
            "/log/no_2.15_exception_users.json",
            "/log/no_2.16_tls_version.json",
            "/log/no_3.1_syslog_persistent.json",
            "/log/no_3.2_syslog_remote_loghost.json",
            "/log/no_3.3_hostagent_log_level.json",
            "/log/no_3.4_log_filtering.json",
            "/log/no_3.5_tls_log_verify.json",
            "/log/no_4.1_firewall_services_manual.json",
            "/log/no_4.2_dvfilter_manual.json",
            "/log/no_4.3_bpdu_filter.json",
            "/log/no_4.4_forged_transmits.json",
            "/log/no_4.5_mac_changes.json",
            "/log/no_4.6_vss_promiscuous_mode.json",
            "/log/no_4.7_vss_vlan_restrict.json",
            "/log/no_4.8_vss_vgt_check.json",
            "/log/no_4.9_management_network_manual.json",
            "/log/no_5.1_datastore_unique_names.json",
            "/log/no_6.1_vm_3d_settings.json",
            "/log/no_6.2_vm_pci_passthru.json",
            "/log/no_6.3_vm_audio_device_manual.json",
            "/log/no_6.4_vm_ahci_device_manual.json",
            "/log/no_6.5_vm_usb_xhci_devices.json",
            "/log/no_6.6_vm_serial_port.json",
            "/log/no_6.7_vm_parallel_port.json",
            "/log/no_6.8_vm_cd_drive.json",
            "/log/no_6.9_vm_floppy_drive.json",
            "/log/no_6.10_vm_hardware_version_manual.json",
            "/log/no_7.1_vmware_tools_update_manual.json",
            "/log/no_7.2_vmware_tools_auto_upgrade_manual.json",
            "/log/no_7.3_vmware_tools_prevent_recustomization_manual.json"
        ];

        const tablesDiv = document.getElementById('tables');
        const targetHost = "vx-p-esxi-csz02.vsphere.aiib.org";

        function friendlyFileName(filePath) {
            return filePath.split('/').pop().replace('.json', '');
        }

        async function loadJsonFilesInOrder(files) {
            for (const file of files) {
                try {
                    const response = await fetch(file);
                    const data = await response.json();

                    if (!data || data.length === 0) continue;

                    // 过滤目标主机或 Host 为 null 的记录
                    const filteredData = data.filter(item => item.Host === targetHost || item.Host === null);
                    if (filteredData.length === 0) continue;

                    // 创建表格标题
                    const h2 = document.createElement('h2');
                    h2.textContent = friendlyFileName(file);
                    tablesDiv.appendChild(h2);

                    // 创建表格
                    const table = document.createElement('table');
                    const thead = document.createElement('thead');
                    const tbody = document.createElement('tbody');

                    // 表头
                    const headerRow = document.createElement('tr');
                    Object.keys(filteredData[0]).forEach(key => {
                        const th = document.createElement('th');
                        th.textContent = key;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    // 表体
                    filteredData.forEach(item => {
                        const tr = document.createElement('tr');

                        // 根据 Status 设置整行背景色
                        if (item.Status === "Pass") {
                            tr.style.backgroundColor = "#d4edda"; // 绿色
                        } else {
                            tr.style.backgroundColor = "#f8d7da"; // 红色
                        }

                        Object.values(item).forEach(val => {
                            const td = document.createElement('td');
                            if (Array.isArray(val) || typeof val === 'object') {
                                td.textContent = JSON.stringify(val, null, 2);
                            } else {
                                td.textContent = val !== null ? val : '';
                            }
                            tr.appendChild(td);
                        });
                        tbody.appendChild(tr);
                    });

                    table.appendChild(tbody);
                    tablesDiv.appendChild(table);

                } catch (err) {
                    console.error("加载 JSON 文件失败:", file, err);
                }
            }
        }

        loadJsonFilesInOrder(jsonFiles);
    </script>

    <script>
    const tablesDiv = document.getElementById('tables');
    const targetHost = "vx-p-esxi-csz02.vsphere.aiib.org";

    function friendlyFileName(filePath) {
        return filePath.split('/').pop().replace('.json', '');
    }

    async function loadJsonFilesDynamically() {
        try {
            const response = await fetch('/log_files');
            const jsonFiles = await response.json();

            for (const file of jsonFiles) {
                try {
                    const res = await fetch(file);
                    const data = await res.json();

                    if (!data || data.length === 0) continue;

                    const filteredData = data.filter(item => item.Host === targetHost || item.Host === null);
                    if (filteredData.length === 0) continue;

                    const h2 = document.createElement('h2');
                    h2.textContent = friendlyFileName(file);
                    tablesDiv.appendChild(h2);

                    const table = document.createElement('table');
                    const thead = document.createElement('thead');
                    const tbody = document.createElement('tbody');

                    // 表头
                    const headerRow = document.createElement('tr');
                    Object.keys(filteredData[0]).forEach(key => {
                        const th = document.createElement('th');
                        th.textContent = key;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    // 表体
                    filteredData.forEach(item => {
                        const tr = document.createElement('tr');
                        tr.style.backgroundColor = item.Status === "Pass" ? "#d4edda" : "#f8d7da";

                        Object.values(item).forEach(val => {
                            const td = document.createElement('td');
                            td.textContent = (typeof val === 'object' && val !== null)
                                ? JSON.stringify(val, null, 2)
                                : (val !== null ? val : '');
                            tr.appendChild(td);
                        });

                        tbody.appendChild(tr);
                    });

                    table.appendChild(tbody);
                    tablesDiv.appendChild(table);

                } catch (err) {
                    console.error("加载 JSON 文件失败:", file, err);
                }
            }
        } catch (err) {
            console.error("获取 JSON 文件列表失败:", err);
        }
    }

    loadJsonFilesDynamically();
</script>

</body>
</html>
